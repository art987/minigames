<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€åŒ–è°ƒè¯• - å®šä½è¯­æ³•é”™è¯¯</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: #333; }
        .log-container { 
            background-color: #f5f5f5; 
            padding: 15px; 
            border-radius: 5px; 
            height: 400px; 
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .error { color: #d9534f; }
        .success { color: #5cb85c; }
        .info { color: #337ab7; }
        button { padding: 10px 15px; margin: 10px 0; background-color: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background-color: #2980b9; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç®€åŒ–è°ƒè¯• - å®šä½è¯­æ³•é”™è¯¯</h1>
        <p>æ­¤é¡µé¢åªåŠ è½½åŸºæœ¬æ–‡ä»¶ï¼Œç”¨äºé€æ­¥å®šä½"SyntaxError: Unexpected identifier 'questions'"é”™è¯¯</p>
        
        <div class="log-container" id="log-container"></div>
        
        <button onclick="location.reload()">é‡æ–°åŠ è½½</button>
    </div>

    <script>
        // æ—¥å¿—è®°å½•åŠŸèƒ½
        function log(message, type = 'info') {
            const logContainer = document.getElementById('log-container');
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // é‡å†™console.logï¼Œæ•è·æ‰€æœ‰æ—¥å¿—è¾“å‡º
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;

        console.log = function(...args) {
            log(args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : arg).join(' '), 'info');
            originalConsoleLog.apply(console, args);
        };

        console.error = function(...args) {
            log(args.map(arg => typeof arg === 'object' ? JSON.stringify(arg) : arg).join(' '), 'error');
            originalConsoleError.apply(console, args);
        };

        // åˆ›å»ºä¸€ä¸ªé”™è¯¯å¤„ç†å™¨æ¥æ•è·æœªæ•è·çš„å¼‚å¸¸
        window.addEventListener('error', function(e) {
            console.error(`æ•è·åˆ°å…¨å±€é”™è¯¯: ${e.message} (è¡Œå·: ${e.lineno}, åˆ—å·: ${e.colno}, æ–‡ä»¶: ${e.filename})`);
            
            // ç‰¹åˆ«å…³æ³¨questionsç›¸å…³çš„è¯­æ³•é”™è¯¯
            if (e.message && e.message.includes('questions')) {
                console.error('ğŸš¨ å‘ç°ä¸questionsç›¸å…³çš„è¯­æ³•é”™è¯¯ï¼Œè¿™å¯èƒ½æ˜¯æˆ‘ä»¬è¦æ‰¾çš„é—®é¢˜!');
                
                // å°è¯•è·å–å¹¶åˆ†æå‡ºé”™çš„æ–‡ä»¶å†…å®¹
                if (e.filename) {
                    fetch(e.filename)
                        .then(response => response.text())
                        .then(content => {
                            // æ‰¾åˆ°å‡ºé”™çš„è¡Œé™„è¿‘çš„ä»£ç 
                            const lines = content.split('\n');
                            const errorLine = e.lineno - 1; // è½¬æ¢ä¸º0-basedç´¢å¼•
                            const startLine = Math.max(0, errorLine - 5);
                            const endLine = Math.min(lines.length - 1, errorLine + 5);
                            
                            console.error(`\nğŸ“‹ å‡ºé”™æ–‡ä»¶çš„ç›¸å…³ä»£ç : ${e.filename}`);
                            for (let i = startLine; i <= endLine; i++) {
                                const prefix = (i === errorLine) ? 'âŒ ' : '   ';
                                console.error(`${prefix}${i+1}: ${lines[i]}`);
                            }
                        })
                        .catch(err => console.error('æ— æ³•è·å–å‡ºé”™æ–‡ä»¶çš„å†…å®¹:', err));
                }
            }
        });

        // æ–‡ä»¶åŠ è½½å‡½æ•°
        function loadScript(url, callback, errorCallback) {
            const script = document.createElement('script');
            script.src = url;
            const fileName = url.split('/').pop();
            
            script.onload = function() {
                console.log(`âœ… æˆåŠŸåŠ è½½: ${fileName}`);
                callback && callback();
            };
            
            script.onerror = function() {
                console.error(`âŒ åŠ è½½å¤±è´¥: ${fileName}`);
                errorCallback && errorCallback();
            };
            
            document.head.appendChild(script);
        }

        // æŒ‰é¡ºåºåŠ è½½æ–‡ä»¶ä»¥å®šä½é”™è¯¯
        function loadFilesSequentially() {
            log('å¼€å§‹åŠ è½½åŸºç¡€æ–‡ä»¶...');
            
            // 1. å…ˆåŠ è½½åŸºç¡€çš„TestRegistry
            loadScript('js/tests.js', function() {
                log('\nåŸºç¡€æ–‡ä»¶åŠ è½½å®Œæˆï¼Œå¼€å§‹æµ‹è¯•...');
                
                // 2. æµ‹è¯•åŸºç¡€å¯¹è±¡æ˜¯å¦å­˜åœ¨
                if (window.TestRegistry) {
                    console.log('TestRegistry å·²æˆåŠŸåŠ è½½');
                } else {
                    console.error('TestRegistry æœªåŠ è½½');
                }
                
                // 3. å¼€å§‹é€æ­¥åŠ è½½æµ‹è¯•æ•°æ®æ–‡ä»¶
                log('\nå¼€å§‹åŠ è½½ç¬¬ä¸€ä¸ªæµ‹è¯•æ•°æ®æ–‡ä»¶...');
                
                // æŒ‰é¡ºåºåŠ è½½æµ‹è¯•æ•°æ®æ–‡ä»¶ï¼Œé€ä¸ªæ·»åŠ æ¥å®šä½é”™è¯¯
                const testFiles = [
                    'data/å¿ƒç†æµ‹è¯„ç±»/procrastination_level.js',
                    'data/å¿ƒç†æµ‹è¯„ç±»/happiness_index.js',
                    'data/å¿ƒç†æµ‹è¯„ç±»/mbti_short.js',
                    'data/å¿ƒç†æµ‹è¯„ç±»/emotion_stability.js',
                    'data/å¿ƒç†æµ‹è¯„ç±»/stress_tolerance.js',
                    'data/çˆ±æƒ…ä¸äººé™…å…³ç³»ç±»/love_philosophy.js',
                    'data/çˆ±æƒ…ä¸äººé™…å…³ç³»ç±»/attachment_style.js',
                    'data/çˆ±æƒ…ä¸äººé™…å…³ç³»ç±»/social_anxiety_index.js',
                    'data/å¥åº·ä¸ç”Ÿæ´»ä¹ æƒ¯ç±»/stay_up_late_index.js',
                    'data/æ™ºåŠ›ä¸é€»è¾‘ç±»/iq60.js'
                ];
                
                let currentFileIndex = 0;
                
                function loadNextFile() {
                    if (currentFileIndex >= testFiles.length) {
                        console.log('\nâœ… æ‰€æœ‰æ–‡ä»¶åŠ è½½å®Œæˆï¼Œæ²¡æœ‰å‘ç°è¯­æ³•é”™è¯¯!');
                        console.log('\n===== æœ€ç»ˆç¯å¢ƒçŠ¶æ€ =====');
                        console.log(`TestRegistry: ${window.TestRegistry ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
                        console.log(`TestDatasets: ${window.TestDatasets ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
                        if (window.TestDatasets) {
                            console.log(`TestDatasets ä¸­çš„æµ‹è¯•: ${Object.keys(window.TestDatasets).join(', ')}`);
                        }
                        return;
                    }
                    
                    const nextFile = testFiles[currentFileIndex];
                    const fileName = nextFile.split('/').pop();
                    
                    console.log(`\nåŠ è½½æ–‡ä»¶ ${currentFileIndex + 1}/${testFiles.length}: ${fileName}`);
                    
                    loadScript(nextFile, function() {
                        console.log(`âœ… æˆåŠŸåŠ è½½: ${fileName}`);
                        currentFileIndex++;
                        
                        // å¦‚æœåŠ è½½æˆåŠŸï¼Œç»§ç»­åŠ è½½ä¸‹ä¸€ä¸ªæ–‡ä»¶
                        setTimeout(loadNextFile, 100); // çŸ­æš‚å»¶è¿Ÿï¼Œç¡®ä¿æ—¥å¿—æ¸…æ™°å¯è§
                    });
                }
                
                // å¼€å§‹é€ä¸ªåŠ è½½æ–‡ä»¶
                loadNextFile();
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹åŠ è½½æ–‡ä»¶
        document.addEventListener('DOMContentLoaded', loadFilesSequentially);
    </script>
</body>
</html>