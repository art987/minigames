<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu</title>
    <link rel="stylesheet" href="menu.css">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src="menudata.js"></script>
</head>
<body>
    <div class="navbar" id="navbar">
        <div class="logo" id="menu-logo"></div>
        <div class="menu-button" onClick="toggleMenu()">
            <span class="menu-icon" id="menu-icon">☰</span>
            <span id="menu-text">菜单</span>
        </div>
    </div>
    <div class="overlay" id="overlay" onClick="toggleMenu()"></div>
    <div class="sidebar" id="sidebar"></div>

    <script>
        // 初始化菜单
        function initMenu() {
            // 设置logo
            document.getElementById('menu-logo').textContent = menuData.logo;
            
            // 构建菜单项
            const sidebar = document.getElementById('sidebar');
            menuData.menuItems.forEach((item, index) => {
                if (item.singleItem) {
                    // 单个菜单项
                    const div = document.createElement('div');
                    div.className = 'menu-item';
                    div.innerHTML = `<a href="${item.href}" class="${item.icon}">${item.text}</a>`;
                    sidebar.appendChild(div);
                } else {
                    // 带子菜单的项
                    const submenuId = `submenu${index + 1}`;
                    
                    // 主菜单项
                    const menuItem = document.createElement('div');
                    menuItem.className = 'menu-item';
                    menuItem.setAttribute('onClick', `toggleSubmenu('${submenuId}')`);
                    menuItem.innerHTML = `${item.title} <span class="expand-icon">+</span>`;
                    sidebar.appendChild(menuItem);
                    
                    // 子菜单
                    const submenu = document.createElement('div');
                    submenu.className = 'submenu';
                    submenu.id = submenuId;
                    submenu.style.display = 'none';
                    
                    item.items.forEach(subItem => {
                        const subMenuItem = document.createElement('div');
                        subMenuItem.className = 'menu-item';
                        subMenuItem.innerHTML = `<a href="${subItem.href}" class="${subItem.icon}">${subItem.text}</a>`;
                        submenu.appendChild(subMenuItem);
                    });
                    
                    sidebar.appendChild(submenu);
                }
            });
        }

        let isMenuOpen = false;
        let lastScrollY = window.scrollY;
        const navbar = document.getElementById('navbar');
        const menuText = document.getElementById('menu-text');
        const menuIcon = document.getElementById('menu-icon');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        function toggleMenu() {
            sidebar.classList.toggle('open');
            overlay.style.display = isMenuOpen ? 'none' : 'block';
            menuIcon.textContent = isMenuOpen ? '☰' : '✖';
            menuText.textContent = isMenuOpen ? '菜单' : '关闭';
            isMenuOpen = !isMenuOpen;
        }

        function toggleSubmenu(submenuId) {
            const submenu = document.getElementById(submenuId);
            submenu.style.display = submenu.style.display === 'block' ? 'none' : 'block';
        }

        window.addEventListener('scroll', (event) => {
            if (!isMenuOpen) {
                const currentScrollY = window.scrollY;
                if (currentScrollY < lastScrollY) {
                    navbar.classList.remove('hidden');
                } else {
                    navbar.classList.add('hidden');
                }
                lastScrollY = currentScrollY;
            }
        });

        overlay.addEventListener('scroll', (event) => {
            event.stopPropagation();
        });

        // 初始化菜单
        document.addEventListener('DOMContentLoaded', initMenu);
    </script>
</body>
</html>