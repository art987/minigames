<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>PostDIY - 海报编辑器</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="editor-style.css" rel="stylesheet"> 
  <!-- html2canvas 用于图片导出 -->
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <!-- 节日数据 -->
  <script src="festivals.js"></script>
  <!-- 模板数据 -->
  <script src="templates.js"></script>
  <!-- 工具函数 -->
  <script src="utils.js"></script>
  <style>
   
  </style>
</head>
<body>
  <!-- 返回按钮 -->
  <div class="back-button-container" style="position: fixed; top: 20px; left: 20px; z-index: 100;">
    <button id="backToHomeBtn" class="back-button" style="background-color: rgba(255, 255, 255, 0.9); border: none; border-radius: 50%; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15); cursor: pointer; transition: all 0.2s ease;">
      <i class="fa fa-arrow-left" style="font-size: 18px; color: #333;"></i>
    </button>
  </div>

  <!-- 预览区域 -->
  <div class="preview-wrapper">
    <div id="posterFrame" class="poster-frame">
      <!-- 海报背景 -->
      <img id="posterBackground" class="poster-background" src="" alt="海报背景" style="width: 100%; height: 100%; object-fit: cover;">
      
      <!-- 海报内容 -->
        <div id="posterContent" class="poster-content" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; justify-content: space-between; padding: 20px;">
          <!-- 海报头部（商家Logo和名称） -->
          <div class="poster-header" style="display: flex; align-items: center; gap: 15px; justify-content: flex-start;">
            <div id="posterLogo" class="poster-logo" style="width: 60px; height: 60px; border-radius: 50%; overflow: hidden; background-color: rgba(255, 255, 255, 0.8); display: flex; align-items: center; justify-content: center;">
              <img id="posterLogoImg" src="" alt="商家Logo" class="hidden" style="width: 100%; height: 100%; object-fit: cover;">
              <i class="fa fa-building text-gray-400" id="logoPlaceholder" style="font-size: 30px;"></i>
            </div>
            <div id="posterBusinessName" class="poster-business-name" >点击编辑商家名称</div>
          </div>
          
          <!-- 海报底部（二维码和促销信息） -->
          <div class="poster-footer" style="display: flex; align-items: center; gap: 15px; justify-content: flex-start;">
            <div id="posterQrcode" class="poster-qrcode" style="width: 80px; height: 80px; background-color: rgba(255, 255, 255, 0.8); display: flex; align-items: center; justify-content: center;">
              <img id="posterQrcodeImg" src="" alt="二维码" class="hidden" style="width: 100%; height: 100%; object-fit: cover;">
              <i class="fa fa-qrcode text-gray-400" id="qrcodePlaceholder" style="font-size: 40px;"></i>
            </div>
            <div id="posterPromoText" class="poster-promo-text" style="font-size: 16px; color: #333; margin: 0;">点击编辑促销信息</div>
          </div>
        </div>
    </div>
  </div>
  
  <!-- 隐藏的背景上传区域 -->
  <div class="hidden">
    <input type="file" id="backgroundInput" accept="image/*" class="hidden">
  </div>
  
  <!-- 底部固定按钮栏 -->
  <div class="bottom-actions">
    <button id="changeTemplateBtn" class="action-btn">
      <i class="fa fa-image"></i>
      <span>选择模板</span>
    </button>
    <button id="editBusinessInfoBtn" class="action-btn">
      <i class="fa fa-building"></i>
      <span>编辑商家信息</span>
    </button>
    <button id="uploadBackgroundBtn" class="action-btn">
      <i class="fa fa-picture-o"></i>
      <span>上传背景</span>
    </button>
    <button id="downloadBtn" class="action-btn">
      <i class="fa fa-download"></i>
      <span>下载海报</span>
    </button>
  </div>

  <!-- 模板选择弹窗 -->
  <div id="templateModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">选择模板</h2>
        <button id="closeTemplateModalBtn" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <!-- 月份选择 -->
        <div class="modal-months-container">
          <h3 class="text-lg font-medium mb-3">选择月份</h3>
          <div class="modal-months-grid" id="modalMonthButtons"></div>
        </div>
        
        <!-- 节日选择 -->
        <div class="modal-festivals-container">
          <h3 class="text-lg font-medium mb-3">选择节日</h3>
          <div class="modal-festivals-scroll">
            <div class="modal-festivals-grid" id="modalFestivalTags"></div>
          </div>
        </div>
        
        <!-- 模板列表 -->
        <div class="mt-6">
          <h3 class="text-lg font-medium mb-3">可用模板</h3>
          <div id="modalTemplatesGrid"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="cancelTemplateBtn" class="editor-button editor-button-secondary">取消</button>
        <button id="confirmTemplateBtn" class="editor-button">确定</button>
      </div>
    </div>
  </div>

  <!-- 商家信息编辑弹窗 -->
  <div id="businessInfoModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">编辑商家信息</h2>
        <button id="closeBusinessInfoModalBtn" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="businessInfoForm">
          <div class="form-group">
            <label class="form-label" for="business-name">商家名称 <span class="text-error-color">*</span></label>
            <input type="text" id="business-name" class="form-input" placeholder="请输入商家名称" required>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="business-logo">商家Logo</label>
            <div id="logoUploadArea" class="upload-area">
              <svg class="upload-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12,19.2A6.8,6.8 0 0,1 5.2,12.4A6.806,6.806 0 0,1 12,5.6C17.3,5.6 21.6,10 21.6,15.2C21.6,17.5 20.8,19.7 19.2,21.2L12,21.2L12,19.2M12,17.73C10.8,17.73 9.73,16.67 9.73,15.47C9.73,14.27 10.8,13.2 12,13.2C13.2,13.2 14.27,14.27 14.27,15.47C14.27,16.67 13.2,17.73 12,17.73M12,4.93C7.13,4.93 3.14,8.87 3.14,13.67C3.14,18.47 7.13,22.4 12,22.4C16.87,22.4 20.86,18.47 20.86,13.67C20.86,8.87 16.87,4.93 12,4.93Z"/>
              </svg>
              <p class="upload-text">上传商家Logo</p>
              <p class="upload-hint">支持JPG、PNG、GIF格式，最大10MB</p>
              <input type="file" id="logoInput" accept="image/*" class="hidden">
            </div>
            <div id="logoPreview" class="upload-preview hidden">
              <img id="logoPreviewImg" src="" alt="Logo预览" class="upload-preview-image">
              <button type="button" id="removeLogoBtn" class="upload-remove-btn">
                <i class="fa fa-times"></i>
              </button>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="business-qrcode">二维码</label>
            <div id="qrcodeUploadArea" class="upload-area">
              <svg class="upload-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M4.2,16.8C4.2,18.79 5.8,20.4 7.8,20.4H16.2C18.2,20.4 19.8,18.8 19.8,16.8V7.2C19.8,5.2 18.2,3.6 16.2,3.6H7.8C5.8,3.6 4.2,5.2 4.2,7.2V16.8M7.8,16.8V7.2H16.2V16.8H7.8M7.8,10.8H16.2V13.8H7.8V10.8M19.8,16.8V13.8H21.6V16.8C21.6,19.8 19.2,22.2 16.2,22.2H7.8C4.8,22.2 2.4,19.8 2.4,16.8V13.8H4.2V16.8C4.2,18.8 5.8,20.4 7.8,20.4H16.2C18.2,20.4 19.8,18.8 19.8,16.8M7.8,22.2V20.4H16.2V22.2H7.8M22.2,4.8V7.2H24V4.8H22.2M0,4.8V7.2H1.8V4.8H0M4.8,0V1.8H7.2V0H4.8M16.8,0V1.8H19.2V0H16.8M16.8,22.2V24H19.2V22.2H16.8M4.8,22.2V24H7.2V22.2H4.8Z"/>
              </svg>
              <p class="upload-text">上传二维码</p>
              <p class="upload-hint">支持JPG、PNG、GIF格式，最大10MB</p>
              <input type="file" id="qrcodeInput" accept="image/*" class="hidden">
            </div>
            <div id="qrcodePreview" class="upload-preview hidden">
              <img id="qrcodePreviewImg" src="" alt="二维码预览" class="upload-preview-image">
              <button type="button" id="removeQrcodeBtn" class="upload-remove-btn">
                <i class="fa fa-times"></i>
              </button>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="promotion-text">促销信息</label>
            <input type="text" id="promotion-text" class="form-input" placeholder="请输入促销信息（如：全场8折）">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button id="cancelBusinessInfoBtn" class="editor-button editor-button-secondary">取消</button>
        <button id="saveBusinessInfoBtn" class="editor-button">保存</button>
      </div>
    </div>
  </div>

  <!-- 编辑器脚本 -->
  <script src="editor-script.js"></script>
  
  <!-- 调试脚本 -->
  <script>
    // 编辑器加载调试
    document.addEventListener('DOMContentLoaded', function() {
      console.log('编辑器页面加载完成');
      
      // 获取URL参数
      const urlParams = new URLSearchParams(window.location.search);
      const templateId = urlParams.get('templateId');
      console.log('加载的模板ID:', templateId);
      
      // 编辑器调试器
      window.editorDebugger = {
        getCurrentTemplate: function() {
          return window.currentTemplate;
        },
        getBusinessInfo: function() {
          return window.businessInfo;
        },
        resetEditor: function() {
          if (window.resetEditor) {
            window.resetEditor();
          }
        }
      };
      
      console.log('编辑器调试器已加载:', window.editorDebugger);
    });
  </script>
</body>
</html>